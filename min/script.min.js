var Card=Class.extend({init:function(e){this.id=e.getAttribute("id");for(var n=0;n<e.childNodes.length;n++){var o=e.childNodes.item(n),t=o.nodeName;1===o.nodeType&&(this[t]=o.textContent)}}}),JunctionCard=Card.extend({init:function(e){this._super(e)}}),Game=Class.extend({init:function(){this.tiles={},this.order=[],this.position=0,this.numberOfRooms=12,this.objective=null}}),wh=wh||{},debug=!1;wh.dungeon={rawTiles:{},jsonTiles:{},current:{position:0,isObjective:!1},highlightCorrectButtons:function(e){var n=$(document.getElementById("liveGame"));e>0?n.removeClass("firstRoom").removeClass("objectiveRoom"):$(document.getElementById("liveGame")).addClass("firstRoom")},getNextCard:function(e){if(e)var n=e.id;var o=wh.dungeon.current;return"moveForwards"===n?(o.position=o.position+1,o.Game.position=o.Game.position+1):"moveBackwards"===n&&(o.position=o.position-1,o.Game.position=o.Game.position-1),position=o.order[o.position],wh.dungeon.highlightCorrectButtons(o.position),"Objective"===wh.dungeon.jsonTiles[position].type&&wh.dungeon.handleObjective(o.position),wh.dungeon.jsonTiles[position]},handleObjective:function(e){var n=document.getElementById("liveGame");n.className+="objectiveRoom",wh.dungeon.current.order=wh.dungeon.current.order.slice(0,e+1),console.log(wh.dungeon.current.order)},shownTiles:[],readDungeon:function(){$.ajax({type:"GET",url:"dungeonclassic.xml",dataType:"xml",success:wh.dungeon.setRawTiles})},setRawTiles:function(e){wh.dungeon.rawTiles=$(e)},getTileType:function(e){var n=$.extend(!0,{},wh.dungeon.rawTiles),o=$(n).find("tile").filter(function(){return $("type",this).text()==e});return o},getAllButTileType:function(e){var n=$.extend(!0,{},wh.dungeon.rawTiles),o=$(n).find("tile").filter(function(){return $("type",this).text()!=e});return o},getNumberOfRooms:function(){return parseInt(document.getElementById("numberOfRoomsInput").value,10)},getObjective:function(e){return"number"==typeof e?wh.dungeon.rawTiles.allObjectives[e]:wh.dungeon.current.objective?wh.dungeon.current.objective:!1},setupObjectives:function(){var e=document.getElementById("objectiveType"),n=wh.dungeon.getTileType("Objective"),o="";wh.dungeon.rawTiles.allObjectives=n,$.each(n,function(e,n){o+="<li data-index='"+e+"'>"+$(n).find("name").text()+"</li>"}),e.innerHTML=o,wh.dungeon.handleObjectiveClicks()},handleObjectiveClicks:function(){$(document.getElementById("objectiveType")).on("click","li",function(e){var n=wh.dungeon.getObjective($(e.target).data("index"));wh.dungeon.setObjective(n),document.querySelectorAll(".selected").length&&(document.querySelectorAll(".selected")[0].className=""),e.target.className="selected",wh.dungeon.showGenerator(),wh.dungeon.handleGeneratorClicks()})},handleGeneratorClicks:function(){$(document.getElementById("generateDungeon")).click(function(){wh.dungeon.current.Game.numberOfRooms=wh.dungeon.getNumberOfRooms(),wh.dungeon.current.numberOfTiles=wh.dungeon.getNumberOfRooms(),wh.dungeon.generateDungeon(),wh.dungeon.showGame()})},makeDebug:function(){for(var e=$("#debug"),n="",o=wh.dungeon,t=0;t<o.current.order.length;t++)n+="<li>"+o.jsonTiles[o.current.order[t]].name+"</li>";e.html(n)},showGenerator:function(){document.getElementById("generateDungeon").style.display="block"},save:function(){localStorage.setItem("whDungeonCurrent",JSON.stringify(wh.dungeon.current)),localStorage.setItem("whDungeonJson",JSON.stringify(wh.dungeon.jsonTiles))},load:function(){wh.dungeon.current=JSON.parse(localStorage.getItem("whDungeonCurrent")),wh.dungeon.jsonTiles=JSON.parse(localStorage.getItem("whDungeonJson"))},showGame:function(){debug&&wh.dungeon.makeDebug(),wh.dungeon.loadLiveGame(),wh.dungeon.showCard(wh.dungeon.getNextCard())},loadHome:function(){$("#liveGame").hide(),$("#gameSetup").hide(),$("#newOrLoad").show()},loadGameSetup:function(){$("#liveGame").hide(),$("#gameSetup").show(),$("#newOrLoad").hide()},loadLiveGame:function(){$("#liveGame").show(),$("#gameSetup").hide(),$("#newOrLoad").hide()},generateDungeon:function(){var e,n,o=wh.dungeon.getAllButTileType("Objective"),t=[],i=[];wh.dungeon.jsonTiles=wh.dungeon.xmlCardsToJson(o),obj=wh.dungeon.getObjective(),wh.dungeon.jsonTiles[obj.id]=obj,e=wh.dungeon.jsonTiles.NAMELIST,n=wh.dungeon.getDivisionIndex(),e=wh.dungeon.shuffle(e),e=e.slice(0,wh.dungeon.current.numberOfTiles-1),t=e.slice(0,n),i=e.slice(n),i.push(wh.dungeon.getObjective().id),i=wh.dungeon.shuffle(i),e=t.concat(i),wh.dungeon.current.order=e,wh.dungeon.current.Game.tiles=wh.dungeon.jsonTiles,wh.dungeon.current.Game.order=e},setObjective:function(e){wh.dungeon.current.objective=new Card(e),wh.dungeon.current.Game.objective=new Card(e)},show:{title:function(){document.getElementById("scenarioName").innerHTML=wh.dungeon.current.Game.objective.name},numberOfRooms:function(){document.getElementById("roomNumber").innerHTML=wh.dungeon.current.Game.numberOfTiles}},getDivisionIndex:function(){return divisor=2,divisionIndex=wh.dungeon.current.numberOfTiles/divisor,Math.ceil(divisionIndex)},init:function(){wh.dungeon.checkForOldGames(),wh.dungeon.readDungeon(),$(document).ajaxComplete(function(){wh.dungeon.setupObjectives()}),wh.dungeon.current.Game=new Game},checkForOldGames:function(){null!==localStorage.getItem("whDungeonCurrent")&&wh.dungeon.loadHome()},xmlCardsToJson:function(e){for(var n,o={},t=[],i=0;i<e.length;i++)n=e[i],1===n.nodeType&&(n=new Card(n),o[n.id]=n,t.push(n.id)),o.NAMELIST=t;return o},shuffle:function(e){for(var n,o,t=e.length;0!==t;)o=Math.floor(Math.random()*t),t-=1,n=e[t],e[t]=e[o],e[o]=n;return e},showCard:function(e){wh.dungeon.save();var n=document.getElementById("liveCards"),o=document.getElementById("cardTemplate").innerHTML;n.innerHTML=o,n.querySelectorAll("h1")[0].innerHTML=e.name,n.querySelectorAll(".flavourtext")[0].innerHTML=e.flavourtext,n.querySelectorAll(".cardType")[0].innerHTML=e.type,n.querySelectorAll(".rules")[0].innerHTML=e.rules}},$(document).ready(function(){wh.dungeon.init(),$(".moveCards").click(function(e){var n=wh.dungeon.getNextCard(e.target);wh.dungeon.showCard(n)}),$("#newGame").click(function(){wh.dungeon.loadGameSetup()}),$("#loadGame").click(function(){console.log("go"),wh.dungeon.load(),wh.dungeon.showGame()})});
//# sourceMappingURL=script.min.js.map