var Card=Class.extend({init:function(e){this.id=e.getAttribute("id");for(var n=0;n<e.childNodes.length;n++){var t=e.childNodes.item(n),o=t.nodeName;1===t.nodeType&&(this[o]=t.textContent)}}}),wh=wh||{},debug=!1;wh.dungeon={rawTiles:{},jsonTiles:{},current:{position:0,isObjective:!1},highlightCorrectButtons:function(e){var n=$(document.getElementById("liveGame"));e>0?n.removeClass("firstRoom").removeClass("objectiveRoom"):$(document.getElementById("liveGame")).addClass("firstRoom")},getNextCard:function(e){if(e)var n=e.id;var t=wh.dungeon.current;return"moveForwards"===n?t.position=t.position+1:"moveBackwards"===n&&(t.position=t.position-1),position=t.order[t.position],wh.dungeon.highlightCorrectButtons(t.position),"Objective"===wh.dungeon.jsonTiles[position].type&&wh.dungeon.handleObjective(t.position),wh.dungeon.jsonTiles[position]},handleObjective:function(e){var n=document.getElementById("liveGame");n.className+="objectiveRoom",wh.dungeon.current.order=wh.dungeon.current.order.slice(0,e+1),console.log(wh.dungeon.current.order)},shownTiles:[],readDungeon:function(){$.ajax({type:"GET",url:"dungeonclassic.xml",dataType:"xml",success:wh.dungeon.setRawTiles})},setRawTiles:function(e){wh.dungeon.rawTiles=$(e)},getTileType:function(e){var n=$.extend(!0,{},wh.dungeon.rawTiles),t=$(n).find("tile").filter(function(){return $("type",this).text()==e});return t},getAllButTileType:function(e){var n=$.extend(!0,{},wh.dungeon.rawTiles),t=$(n).find("tile").filter(function(){return $("type",this).text()!=e});return t},getNumberOfRooms:function(){return document.getElementById("numberOfRoomsInput").value},getObjective:function(e){return"number"==typeof e?wh.dungeon.rawTiles.allObjectives[e]:wh.dungeon.current.objective?wh.dungeon.current.objective:!1},setupObjectives:function(){var e=document.getElementById("objectiveType"),n=wh.dungeon.getTileType("Objective"),t="";wh.dungeon.rawTiles.allObjectives=n,$.each(n,function(e,n){t+="<li data-index='"+e+"'>"+$(n).find("name").text()+"</li>"}),e.innerHTML=t,wh.dungeon.handleObjectiveClicks()},handleObjectiveClicks:function(){$(document.getElementById("objectiveType")).on("click","li",function(e){var n=wh.dungeon.getObjective($(e.target).data("index"));wh.dungeon.setObjective(n),document.querySelectorAll(".selected").length&&(document.querySelectorAll(".selected")[0].className=""),e.target.className="selected",wh.dungeon.showGenerator(),wh.dungeon.handleGeneratorClicks()})},handleGeneratorClicks:function(){$(document.getElementById("generateDungeon")).click(function(){wh.dungeon.current.numberOfTiles=wh.dungeon.getNumberOfRooms(),document.getElementById("roomNumber").innerHTML=wh.dungeon.current.numberOfTiles,wh.dungeon.showGame()})},makeDebug:function(){for(var e=$("#debug"),n="",t=wh.dungeon,o=0;o<t.current.order.length;o++)n+="<li>"+t.jsonTiles[t.current.order[o]].name+"</li>";e.html(n)},showGenerator:function(){document.getElementById("generateDungeon").style.display="block"},save:function(){localStorage.setItem("whDungeonCurrent",JSON.stringify(wh.dungeon.current)),localStorage.setItem("whDungeonJson",JSON.stringify(wh.dungeon.jsonTiles))},load:function(){wh.dungeon.current=JSON.parse(localStorage.getItem("whDungeonCurrent")),wh.dungeon.jsonTiles=JSON.parse(localStorage.getItem("whDungeonJson"))},showGame:function(){wh.dungeon.generateDungeon(),debug&&wh.dungeon.makeDebug(),document.getElementById("liveGame").style.display="block",document.getElementById("gameSetup").style.display="none",wh.dungeon.showCard(wh.dungeon.getNextCard())},loadHome:function(){$("#liveGame").hide(),$("#gameSetup").hide(),$("#newOrLoad").show()},loadGameSetup:function(){$("#liveGame").hide(),$("#gameSetup").show(),$("#newOrLoad").hide()},generateDungeon:function(){var e,n,t=wh.dungeon.getAllButTileType("Objective"),o=[],i=[];wh.dungeon.jsonTiles=wh.dungeon.xmlCardsToJson(t),obj=wh.dungeon.getObjective(),wh.dungeon.jsonTiles[obj.id]=obj,e=wh.dungeon.jsonTiles.NAMELIST,n=wh.dungeon.getDivisionIndex(),e=wh.dungeon.shuffle(e),e=e.slice(0,wh.dungeon.current.numberOfTiles-1),o=e.slice(0,n),i=e.slice(n),i.push(wh.dungeon.getObjective().id),i=wh.dungeon.shuffle(i),e=o.concat(i),wh.dungeon.current.order=e},setObjective:function(e){wh.dungeon.current.objective=new Card(e),document.getElementById("scenarioName").innerHTML=$(e).find("name").text()},getDivisionIndex:function(){return divisor=2,divisionIndex=wh.dungeon.current.numberOfTiles/divisor,Math.ceil(divisionIndex)},init:function(){wh.dungeon.readDungeon(),$(document).ajaxComplete(function(){wh.dungeon.setupObjectives()})},xmlCardsToJson:function(e){for(var n,t={},o=[],i=0;i<e.length;i++)n=e[i],1===n.nodeType&&(n=new Card(n),t[n.id]=n,o.push(n.id)),t.NAMELIST=o;return t},shuffle:function(e){for(var n,t,o=e.length;0!==o;)t=Math.floor(Math.random()*o),o-=1,n=e[o],e[o]=e[t],e[t]=n;return e},showCard:function(e){wh.dungeon.save();var n=document.getElementById("liveCards"),t=document.getElementById("cardTemplate").innerHTML;n.innerHTML=t,n.querySelectorAll("h1")[0].innerHTML=e.name,n.querySelectorAll(".flavourtext")[0].innerHTML=e.flavourtext,n.querySelectorAll(".cardType")[0].innerHTML=e.type,n.querySelectorAll(".rules")[0].innerHTML=e.rules}},$(document).ready(function(){wh.dungeon.init(),$(".moveCards").click(function(e){var n=wh.dungeon.getNextCard(e.target);wh.dungeon.showCard(n)}),$("#newGame").click(function(){wh.dungeon.loadGameSetup()}),$("#loadGame").click(function(){wh.dungeon.load()})});
//# sourceMappingURL=script.min.js.map