var Card=Class.extend({init:function(e){this.id=e.getAttribute("id");for(var n=0;n<e.childNodes.length;n++){var t=e.childNodes.item(n),o=t.nodeName;1===t.nodeType&&(this[o]=t.textContent)}}}),Room=Card.extend({init:function(e){console.log("Room",e)}}),wh=wh||{};wh.dungeon={rawTiles:{},jsonTiles:{},current:{position:0},popup:function(e){var n=document.getElementById("cardTemplate"),t=$(e).find("name").text(),o=$(e).find("rules").text(),i=$(e).find("flavourtext").text(),r=$(e).find("type").text(),u=window.open("",t,"width=200,height=300,top=260");u.document.write(n.innerHTML),u.document.querySelectorAll("h1")[0].innerHTML=t,u.document.querySelectorAll(".rules")[0].innerHTML=o,u.document.querySelectorAll(".cardType")[0].innerHTML=r,u.document.querySelectorAll(".flavourtext")[0].innerHTML=i},getNextCard:function(){var e=wh.dungeon.current.position;return wh.dungeon.current.position++,e=wh.dungeon.current.order[e],"Objective"===e?(wh.dungeon.handleObjective(),wh.dungeon.getObjective()):wh.dungeon.rawTiles.nonObjectives[e]},handleObjective:function(){var e=document.getElementById("liveGame");e.className+="objectiveRoom"},shownTiles:[],readDungeon:function(){$.ajax({type:"GET",url:"dungeonclassic.xml",dataType:"xml",success:wh.dungeon.setRawTiles})},setRawTiles:function(e){wh.dungeon.rawTiles=$(e),console.log("test",e)},getTileType:function(e){var n=$.extend(!0,{},wh.dungeon.rawTiles),t=$(n).find("tile").filter(function(){return $("type",this).text()==e});return t},getAllButTileType:function(e){var n=$.extend(!0,{},wh.dungeon.rawTiles),t=$(n).find("tile").filter(function(){return $("type",this).text()!=e});return t},getNumberOfRooms:function(){return document.getElementById("numberOfRoomsInput").value},getObjective:function(e){return"number"==typeof e?wh.dungeon.rawTiles.allObjectives[e]:wh.dungeon.current.objective?wh.dungeon.current.objective:!1},setupObjectives:function(){var e=document.getElementById("objectiveType"),n=wh.dungeon.getTileType("Objective"),t="";wh.dungeon.rawTiles.allObjectives=n,$.each(n,function(e,n){t+="<li data-index='"+e+"'>"+$(n).find("name").text()+"</li>"}),e.innerHTML=t,wh.dungeon.handleObjectiveClicks()},handleObjectiveClicks:function(){$(document.getElementById("objectiveType")).on("click","li",function(e){console.log($(e.target).data("index"));var n=wh.dungeon.getObjective($(e.target).data("index"));wh.dungeon.setObjective(n),document.querySelectorAll(".selected").length&&(document.querySelectorAll(".selected")[0].className=""),e.target.className="selected",wh.dungeon.showGenerator(),wh.dungeon.handleGeneratorClicks()})},handleGeneratorClicks:function(){$(document.getElementById("generateDungeon")).click(function(){wh.dungeon.current.numberOfTiles=wh.dungeon.getNumberOfRooms(),document.getElementById("roomNumber").innerHTML=wh.dungeon.current.numberOfTiles,wh.dungeon.generateDungeon(),document.getElementById("liveGame").style.display="block",document.getElementById("gameSetup").style.display="none",wh.dungeon.showCard(wh.dungeon.getNextCard())})},showGenerator:function(){document.getElementById("generateDungeon").style.display="block"},generateDungeon:function(){var e,n,t=wh.dungeon.getAllButTileType("Objective"),o=[],i=[],r=[];wh.dungeon.rawTiles.nonObjectives=e=t,n=wh.dungeon.getDivisionIndex();for(var u=0;u<e.length;u++)o.push(u);o=wh.dungeon.shuffle(o),o=o.slice(0,wh.dungeon.current.numberOfTiles-1),i=o.slice(0,n),r=o.slice(n),r.push("Objective"),r=wh.dungeon.shuffle(r),o=i.concat(r),wh.dungeon.current.order=o},setObjective:function(e){wh.dungeon.current.objective=e,console.log($(e).find("name").text()),document.getElementById("scenarioName").innerHTML=$(e).find("name").text()},getDivisionIndex:function(){return divisor=2,divisionIndex=wh.dungeon.current.numberOfTiles/divisor,Math.ceil(divisionIndex)},init:function(){wh.dungeon.readDungeon(),$(document).ajaxComplete(function(){wh.dungeon.setupObjectives()})},xmlCardsToJson:function(e){for(var n,t={},o=0;o<e.length;o++)n=e[o],1===n.nodeType&&(n=new Card(n),t[n.id]=n);return t},shuffle:function(e){for(var n,t,o=e.length;0!==o;)t=Math.floor(Math.random()*o),o-=1,n=e[o],e[o]=e[t],e[t]=n;return e},showCard:function(e){var n=document.getElementById("liveCards"),t=document.getElementById("cardTemplate").innerHTML,o=$(e).find("name").text(),i=$(e).find("rules").text(),r=$(e).find("flavourtext").text(),u=$(e).find("type").text();n.innerHTML=t,n.querySelectorAll("h1")[0].innerHTML=o,n.querySelectorAll(".flavourtext")[0].innerHTML=r,n.querySelectorAll(".cardType")[0].innerHTML=u,n.querySelectorAll(".rules")[0].innerHTML=i}},$(document).ready(function(){wh.dungeon.init(),$("#generateRoom").click(function(){var e=wh.dungeon.getNextCard();console.log(e),wh.dungeon.showCard(e)})});
//# sourceMappingURL=script.min.js.map