var Card=Class.extend({init:function(e){this.id=e.getAttribute("id");for(var n=0;n<e.childNodes.length;n++){var t=e.childNodes.item(n),o=t.nodeName;1===t.nodeType&&(this[o]=t.textContent)}}}),JunctionCard=Card.extend({init:function(e){this._super(e)}}),Game=Class.extend({init:function(){this.tiles={},this.order=[],this.position=0,this.numberOfRooms=12,this.objective=null}}),wh=wh||{},debug=!1;wh.dungeon={rawTiles:{},current:{},highlightCorrectButtons:function(e){var n=$(document.getElementById("liveGame"));e>0?n.removeClass("firstRoom").removeClass("objectiveRoom"):$(document.getElementById("liveGame")).addClass("firstRoom")},getNextCard:function(e){if(e)var n=e.id;var t=wh.dungeon.current;return"moveForwards"===n?t.position=t.position+1:"moveBackwards"===n&&(t.position=t.position-1),position=t.order[t.position],wh.dungeon.highlightCorrectButtons(t.position),"Objective"===wh.dungeon.current.tiles[position].type&&wh.dungeon.handleObjective(t.position),wh.dungeon.current.tiles[position]},handleObjective:function(e){var n=document.getElementById("liveGame");n.className+="objectiveRoom",wh.dungeon.current.order=wh.dungeon.current.order.slice(0,e+1),console.log(wh.dungeon.current.order)},shownTiles:[],readDungeon:function(){$.ajax({type:"GET",url:"dungeonclassic.xml",dataType:"xml",success:wh.dungeon.setRawTiles})},setRawTiles:function(e){wh.dungeon.rawTiles=$(e)},getTileType:function(e){var n=$.extend(!0,{},wh.dungeon.rawTiles),t=$(n).find("tile").filter(function(){return $("type",this).text()==e});return t},getAllButTileType:function(e){var n=$.extend(!0,{},wh.dungeon.rawTiles),t=$(n).find("tile").filter(function(){return $("type",this).text()!=e});return t},getNumberOfRooms:function(){return parseInt(document.getElementById("numberOfRoomsInput").value,10)},getObjective:function(e){return"number"==typeof e?wh.dungeon.rawTiles.allObjectives[e]:wh.dungeon.current.objective?wh.dungeon.current.objective:!1},setupObjectives:function(){var e=document.getElementById("objectiveType"),n=wh.dungeon.getTileType("Objective"),t="";wh.dungeon.rawTiles.allObjectives=n,$.each(n,function(e,n){t+="<li data-index='"+e+"'>"+$(n).find("name").text()+"</li>"}),e.innerHTML=t,wh.dungeon.handleObjectiveClicks()},handleObjectiveClicks:function(){$(document.getElementById("objectiveType")).on("click","li",function(e){var n=wh.dungeon.getObjective($(e.target).data("index"));wh.dungeon.setObjective(n),document.querySelectorAll(".selected").length&&(document.querySelectorAll(".selected")[0].className=""),e.target.className="selected",wh.dungeon.showGenerator(),wh.dungeon.handleGeneratorClicks()})},handleGeneratorClicks:function(){$(document.getElementById("generateDungeon")).click(function(){wh.dungeon.current.numberOfRooms=wh.dungeon.getNumberOfRooms(),wh.dungeon.generateDungeon(),wh.dungeon.showGame()})},makeDebug:function(){for(var e=$("#debug"),n="",t=wh.dungeon,o=0;o<t.current.order.length;o++)n+="<li>"+t.current.tiles[t.current.order[o]].name+"</li>";e.html(n)},showGenerator:function(){document.getElementById("generateDungeon").style.display="block"},save:function(){localStorage.setItem("whDungeonCurrent",JSON.stringify(wh.dungeon.current))},load:function(){wh.dungeon.current=JSON.parse(localStorage.getItem("whDungeonCurrent"))},showGame:function(){debug&&wh.dungeon.makeDebug(),wh.dungeon.loadLiveGame(),wh.dungeon.showCard(wh.dungeon.getNextCard())},loadHome:function(){$("#liveGame").hide(),$("#gameSetup").hide(),$("#newOrLoad").show()},loadGameSetup:function(){$("#liveGame").hide(),$("#gameSetup").show(),$("#newOrLoad").hide()},loadLiveGame:function(){$("#liveGame").show(),$("#gameSetup").hide(),$("#newOrLoad").hide()},generateDungeon:function(){var e,n,t=wh.dungeon.getAllButTileType("Objective"),o=[],i=[];wh.dungeon.current.tiles=wh.dungeon.xmlCardsToJson(t),obj=wh.dungeon.getObjective(),wh.dungeon.current.tiles[obj.id]=obj,e=wh.dungeon.current.tiles.NAMELIST,n=wh.dungeon.getDivisionIndex(),e=wh.dungeon.shuffle(e),e=e.slice(0,wh.dungeon.current.numberOfRooms-1),o=e.slice(0,n),i=e.slice(n),i.push(wh.dungeon.getObjective().id),i=wh.dungeon.shuffle(i),e=o.concat(i),wh.dungeon.current.order=e},setObjective:function(e){wh.dungeon.current.objective=new Card(e)},show:{title:function(){document.getElementById("scenarioName").innerHTML=wh.dungeon.current.objective.name},numberOfRooms:function(){document.getElementById("roomNumber").innerHTML=wh.dungeon.current.numberOfTiles}},getDivisionIndex:function(){return divisor=2,divisionIndex=wh.dungeon.current.numberOfTiles/divisor,Math.ceil(divisionIndex)},init:function(){wh.dungeon.checkForOldGames(),wh.dungeon.current=new Game,wh.dungeon.readDungeon(),$(document).ajaxComplete(function(){wh.dungeon.setupObjectives()})},checkForOldGames:function(){null!==localStorage.getItem("whDungeonCurrent")&&wh.dungeon.loadHome()},xmlCardsToJson:function(e){for(var n,t={},o=[],i=0;i<e.length;i++)n=e[i],1===n.nodeType&&(n=new Card(n),t[n.id]=n,o.push(n.id)),t.NAMELIST=o;return t},shuffle:function(e){for(var n,t,o=e.length;0!==o;)t=Math.floor(Math.random()*o),o-=1,n=e[o],e[o]=e[t],e[t]=n;return e},showCard:function(e){wh.dungeon.save();var n=document.getElementById("liveCards"),t=document.getElementById("cardTemplate").innerHTML;n.innerHTML=t,n.querySelectorAll("h1")[0].innerHTML=e.name,n.querySelectorAll(".flavourtext")[0].innerHTML=e.flavourtext,n.querySelectorAll(".cardType")[0].innerHTML=e.type,n.querySelectorAll(".rules")[0].innerHTML=e.rules}},$(document).ready(function(){wh.dungeon.init(),$(".moveCards").click(function(e){var n=wh.dungeon.getNextCard(e.target);wh.dungeon.showCard(n)}),$("#newGame").click(function(){wh.dungeon.loadGameSetup()}),$("#loadGame").click(function(){console.log("go"),wh.dungeon.load(),wh.dungeon.showGame()})});
//# sourceMappingURL=script.min.js.map